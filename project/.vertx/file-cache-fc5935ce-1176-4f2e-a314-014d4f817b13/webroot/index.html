<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Tetris</title>

    <script src="https://cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vertx/3.5.4/vertx-eventbus.min.js"></script>

    <script>
        var eb = new EventBus("http://localhost:8080/tetris/game");
        var sendMessage = function (val) {
            eb.send("tetris.game.message", {user : document.getElementById("userID").value, content : val},
                function(err, reply) {
                    console.log("message broadcasted: " + JSON.stringify(reply));

                });
            eb.send("tetris.game.block", {user : document.getElementById("buttonLeft").value, content : val},
                function(err, reply) {
                    console.log("Go to the : " + JSON.stringify(reply));

                });
        };
        eb.onopen = function() {
            eb.registerHandler("tetris.game.main", function (error, message) {
                if (error) {
                    console.log("error: " + JSON.stringify(error));
                };
                console.log("message: " + JSON.stringify(message.body));
                newMessage = document.createElement("li");
                newMessage.innerHTML = JSON.stringify(message.body);
                messagelist.prepend(newMessage);
            });
        };
        // eb.onopen = function () {
        //     eb.registerHandler("tetris.infoBackend.block", function (error, message) {
        //         if (error) {
        //             console.log("error: " + JSON.stringify(error));
        //         };
        //         console.log("message: " + JSON.stringify(message.body));
        //         newMessage = document.createElement("li");
        //         newMessage.innerHTML = JSON.stringify(message.body);
        //         messagelist.prepend(newMessage);
        //     });

    </script>
</head>
<body>

<h1>Chatty application</h1>

<form action="javascript:sendMessage(message.value)">
    <span>User ID:</span><input id="userID" type="text" /><br />
    <span>Message:</span><input id="message" type="text" />
    <input type="submit" value="Send message" />
    <button id="buttonLeft" value="left">left</button>
</form>
<p>
</p>

<ul id="messagelist">
</ul>

</body>
</html>